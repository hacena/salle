const express = require('express');
const nodemailer = require('nodemailer');
const bodyParser = require('body-parser');

const app = express();
app.use(bodyParser.json());
app.use(bodyParser.urlencoded({ extended: true }));

// تخزين المستخدمين والكودات في الذاكرة (يمكن استبدالها بقاعدة بيانات)
const users = [];
const activationCodes = {};

// إعداد Nodemailer لإرسال البريد
const transporter = nodemailer.createTransport({
    service: 'gmail', // يمكنك استخدام أي مزود خدمة بريد آخر
    auth: {
        user: 'ha2502ha@gmail.com',
        pass: 'HA4141ha@'
    }
});

// صفحة التسجيل
app.post('/signup', (req, res) => {
    const { email, password } = req.body;
    const activationCode = Math.floor(100000 + Math.random() * 900000); // كود تفعيل عشوائي

    // إضافة المستخدم إلى قاعدة البيانات (أو تخزينه في الذاكرة مؤقتًا)
    users.push({ email, password, activated: false });
    activationCodes[email] = activationCode;

    // إرسال البريد الإلكتروني مع رابط التفعيل
    const mailOptions = {
        from: 'your-email@gmail.com',
        to: email,
        subject: 'تفعيل حسابك',
        text: `استخدم هذا الكود لتفعيل حسابك: ${activationCode}`
    };

    transporter.sendMail(mailOptions, (error, info) => {
        if (error) {
            return res.status(500).send('حدث خطأ في إرسال البريد.');
        }
        res.json({ success: true });
    });
});

// صفحة التفعيل
app.post('/activate', (req, res) => {
    const { activationCode, email } = req.body;

    if (activationCodes[email] == activationCode) {
        // تفعيل الحساب
        users.find(user => user.email === email).activated = true;
        res.json({ success: true });
